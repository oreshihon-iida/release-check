# リリース対象外コミット検出拡張機能

この拡張機能は、developブランチとmainブランチを比較し、リリース対象外のコミットが含まれていないかをチェックするためのVSCode拡張機能です。本番リリース前の検証作業を効率化し、意図しないコミットが本番環境に反映されるリスクを低減します。

## 主な機能

- **ブランチ比較**: developブランチとmainブランチの差分からコミットコメントを取得
- **リリース対象外コミット検出**: 設定したパターンに基づいてリリース対象外コミットを自動検出
- **プルリクエストURL入力**: 検証対象のプルリクエストURLを記録
- **詳細な結果表示**: WebViewパネルで検出結果を視覚的に確認
- **カスタマイズ設定**: ブランチ名や検出パターンをプロジェクトに合わせて調整可能

## インストール方法

### VSIXファイルからのインストール

1. リポジトリをクローンし、以下のコマンドを実行してVSIXファイルを生成します：
   ```bash
   npm install
   npm run compile
   npx vsce package
   ```

2. 生成された`release-check-0.0.1.vsix`ファイルを使って以下のいずれかの方法でインストールします：
   - VSCodeのコマンドパレット（Ctrl+Shift+P）を開き、「Extensions: Install from VSIX」を選択
   - VSCodeの拡張機能ビュー（Ctrl+Shift+X）で「...」メニューから「Install from VSIX」を選択

## 利用方法

1. VSCodeでGitリポジトリを開きます
2. コマンドパレット（`Ctrl+Shift+P` または `Cmd+Shift+P`）を開きます
3. 「リリース対象外コミットのチェック」コマンドを実行します
4. プルリクエストURLを入力ダイアログに入力します
5. 検出結果がWebViewパネルに表示されます

### 結果の見方

- **成功**: リリース対象外コミットが検出されなかった場合は成功メッセージが表示されます
- **警告**: リリース対象外コミットが検出された場合は、コミットの詳細（ハッシュ、メッセージ、作成者、検出パターン）が表示されます

## 要件

- VSCode 1.99.0以上
- Gitリポジトリが開かれていること
- developブランチとmainブランチが存在すること（設定で変更可能）

## 拡張機能の設定

この拡張機能は以下の設定項目を提供します：

* `release-check.sourceBranch`: 比較元のブランチ名（デフォルト: `develop`）
* `release-check.targetBranch`: 比較先のブランチ名（デフォルト: `main`）
* `release-check.excludePatterns`: リリース対象外と判断するコミットメッセージのパターン（デフォルト: `["WIP", "DO NOT MERGE", "NOT FOR RELEASE"]`）

## 設定方法

1. VSCodeの設定を開きます（`Ctrl+,` または `Cmd+,`）
2. 「拡張機能」→「Release Check」を選択
3. 各設定項目を必要に応じて変更します

### 設定例

```json
{
  "release-check.sourceBranch": "feature",
  "release-check.targetBranch": "production",
  "release-check.excludePatterns": [
    "WIP",
    "DO NOT MERGE",
    "NOT FOR RELEASE",
    "DRAFT",
    "作業中"
  ]
}
```

## 動作の仕組み

1. 指定されたブランチ間の差分コミットを取得
2. 各コミットメッセージを解析し、設定されたパターンと照合
3. リリース対象外パターンに一致するコミットを検出
4. 検出結果を表示（リリース対象外コミットがない場合は成功メッセージ）

### 処理フロー

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  コマンド実行   │────▶│  PR URL入力     │────▶│ ブランチ比較    │
└─────────────────┘     └─────────────────┘     └─────────────────┘
                                                         │
                                                         ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  結果表示       │◀────│  検出結果判定   │◀────│ コミット解析    │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

## ユースケース

この拡張機能は以下のようなシナリオで特に役立ちます：

- **本番リリース前の最終チェック**: リリース直前にdevelopブランチとmainブランチを比較し、意図しないコミットが混入していないか確認
- **コードレビュー補助**: プルリクエストレビュー時に、リリース対象外のコミットが含まれていないか自動チェック
- **リリースプロセスの標準化**: チーム全体で統一されたリリース前チェックを実施

## 注意事項

- この拡張機能はGitリポジトリが開かれている状態でのみ動作します
- 大規模なリポジトリでは、ブランチ間の差分取得に時間がかかる場合があります
- コミットメッセージのパターンマッチングは大文字・小文字を区別します
- プルリクエストURLは検証結果と一緒に表示されますが、APIとの連携は行っていません

## リリースノート

### 0.0.1

- 初回リリース
- developブランチとmainブランチの比較機能
- リリース対象外コミットの検出機能
- プルリクエストURL入力機能
- WebViewパネルでの結果表示
- 設定のカスタマイズ機能

## 開発者向け情報

この拡張機能はTypeScriptで開発されており、simple-gitライブラリを使用してGit操作を行っています。

### 技術スタック

- TypeScript: 拡張機能のコア実装
- VSCode Extension API: VSCodeとの連携
- simple-git: Gitリポジトリ操作
- WebView API: 結果表示用のUIパネル

### ビルド方法

```bash
# 依存関係のインストール
npm install

# コンパイル
npm run compile

# パッケージング
npx vsce package
```

### デバッグ方法

VSCodeでプロジェクトを開き、F5キーを押すと拡張機能開発ホストが起動します。デバッグコンソールでログを確認できます。

### 貢献方法

1. このリポジトリをフォーク
2. 機能追加やバグ修正のためのブランチを作成
3. 変更をコミットしてプッシュ
4. プルリクエストを作成
